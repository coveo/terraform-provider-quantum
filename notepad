Test 1: Resource creation

resource "quantum_password" "test_pw" {
    name = "quantom_password_key1"
    length = 5
  
    // Rotate every n days
    expires_in_days = 5
}

resource "aws_ssm_parameter" "quantom_password_key1" {
  name  = "quantom_password_key1"
  type  = "SecureString"
  value = "${quantum_password.test_pw.password}"
}

resource "aws_s3_bucket_object" "index" {
  bucket = "coveo-ndev-test"
  key = "quantom_password_key1"
  content = "${aws_ssm_parameter.quantom_password_key1.value}"
}

--- PLAN

+ aws_s3_bucket_object.index
    acl:                    "private"
    bucket:                 "coveo-ndev-test"
    content:                "${aws_ssm_parameter.quantom_password_key1.value}"
    content_type:           "<computed>"
    etag:                   "<computed>"
    key:                    "quantom_password_key1"
    server_side_encryption: "<computed>"
    storage_class:          "<computed>"
    version_id:             "<computed>"

+ aws_ssm_parameter.quantom_password_key1
    name:  "quantom_password_key1"
    type:  "SecureString"
    value: "<sensitive>"

+ quantum_password.test_pw
    created_at:      "<computed>"
    expires_in_days: "5"
    length:          "5"
    name:            "quantom_password_key1"
    password:        "<computed>"

Plan: 3 to add, 0 to change, 0 to destroy.

--- APPLY

quantum_password.test_pw: Creating...
  created_at:      "" => "<computed>"
  expires_in_days: "" => "5"
  length:          "" => "5"
  name:            "" => "quantom_password_key1"
  password:        "" => "<computed>"
quantum_password.test_pw: Creation complete (ID: -)
aws_ssm_parameter.quantom_password_key1: Creating...
  name:  "" => "quantom_password_key1"
  type:  "" => "SecureString"
  value: "<sensitive>" => "<sensitive>"
aws_ssm_parameter.quantom_password_key1: Creation complete (ID: quantom_password_key1)
aws_s3_bucket_object.index: Creating...
  acl:                    "" => "private"
  bucket:                 "" => "coveo-ndev-test"
  content:                "" => "7x$%V"
  content_type:           "" => "<computed>"
  etag:                   "" => "<computed>"
  key:                    "" => "quantom_password_key1"
  server_side_encryption: "" => "<computed>"
  storage_class:          "" => "<computed>"
  version_id:             "" => "<computed>"
aws_s3_bucket_object.index: Creation complete (ID: quantom_password_key1)

Apply complete! Resources: 3 added, 0 changed, 0 destroyed.

Test 2: Update length:

resource "quantum_password" "test_pw" {
    name = "quantom_password_key1"
    length = 10
  
    // Rotate every n days
    expires_in_days = 5
}

--- PLAN
~ quantum_password.test_pw
    length: "5" => "10"

--- APPLY

quantum_password.test_pw: Modifying... (ID: -)
  length: "5" => "10"
quantum_password.test_pw: Modifications complete (ID: -)

*** Password updated in quantum resource (newly generated to 10 chars) : O5!!%l7Yp!
*** Other resource are not aware of this change.

Apply complete! Resources: 0 added, 1 changed, 0 destroyed.

--- RE-PLAN

*** Now the plan sees the password change and want to apply it to dependant resource.

~ aws_s3_bucket_object.index
    content: "7x$%V" => "O5!!%l7Yp!"

~ aws_ssm_parameter.quantom_password_key1
    value: "<sensitive>" => "<sensitive>" (attribute changed)

--- RE-APPLY

aws_ssm_parameter.quantom_password_key1: Modifying... (ID: quantom_password_key1)
  value: "<sensitive>" => "<sensitive>"
aws_ssm_parameter.quantom_password_key1: Modifications complete (ID: quantom_password_key1)
aws_s3_bucket_object.index: Modifying... (ID: quantom_password_key1)
  content: "7x$%V" => "O5!!%l7Yp!"
aws_s3_bucket_object.index: Modifications complete (ID: quantom_password_key1)

Apply complete! Resources: 0 added, 2 changed, 0 destroyed.

Test 3: Longer password that changes on every run

resource "quantum_password" "test_pw" {
    name = "quantom_password_key1"
    length = 50
  
    // Rotate every n days
    expires_in_days = -1
}

--- PLAN

~ quantum_password.test_pw
    expires_in_days: "5" => "-1"
    length:          "10" => "50"

--- APPLY

quantum_password.test_pw: Modifying... (ID: -)
  expires_in_days: "5" => "-1"
  length:          "10" => "50"
quantum_password.test_pw: Modifications complete (ID: -)

Apply complete! Resources: 0 added, 1 changed, 0 destroyed.

--- SHOW

aws_s3_bucket_object.index:
  id = quantom_password_key1
  acl = private
  bucket = coveo-ndev-test
  cache_control =
  content = O5!!%l7Yp!
  content_disposition =
  content_encoding =
  content_language =
  content_type = binary/octet-stream
  etag = 18eba631f5cad8058c31f4088859a981
  key = quantom_password_key1
  server_side_encryption =
  storage_class = STANDARD
  tags.% = 0
  version_id = Q7SfdyPVBVJGp2oVfhmY6wODI6jAYMHj
aws_ssm_parameter.quantom_password_key1:
  id = quantom_password_key1
  name = quantom_password_key1
  type = SecureString
  value = O5!!%l7Yp!
quantum_password.test_pw:
  id = -
  created_at = 2017-07-13
  expires_in_days = -1
  length = 50
  name = quantom_password_key1
  password = Ei$#Z!x$13@#o$!7E70GcVi%JX5O3Xj9hT#U$4gu68@s!y3$rB

--- RE-APPLY

quantum_password.test_pw: Refreshing state... (ID: -)
aws_ssm_parameter.quantom_password_key1: Refreshing state... (ID: quantom_password_key1)
aws_s3_bucket_object.index: Refreshing state... (ID: quantom_password_key1)
aws_ssm_parameter.quantom_password_key1: Modifying... (ID: quantom_password_key1)
  value: "<sensitive>" => "<sensitive>"
aws_ssm_parameter.quantom_password_key1: Modifications complete (ID: quantom_password_key1)
aws_s3_bucket_object.index: Modifying... (ID: quantom_password_key1)
  content: "O5!!%l7Yp!" => "HiQ4Kv!h!5!%%4r#E@3576X2x@y!J26N%8$C1xvoG%YX%$Jsdy"
aws_s3_bucket_object.index: Modifications complete (ID: quantom_password_key1)

Apply complete! Resources: 0 added, 2 changed, 0 destroyed.

--- SHOW

aws_s3_bucket_object.index:
  id = quantom_password_key1
  acl = private
  bucket = coveo-ndev-test
  cache_control =
  content = HiQ4Kv!h!5!%%4r#E@3576X2x@y!J26N%8$C1xvoG%YX%$Jsdy
  content_disposition =
  content_encoding =
  content_language =
  content_type = binary/octet-stream
  etag = 4d6ce999eca46dd7108d2bf60614c149
  key = quantom_password_key1
  server_side_encryption =
  storage_class = STANDARD
  tags.% = 0
  version_id = WPRLfluUZAKlFMWMYuBbhztfmi6JvP0p
aws_ssm_parameter.quantom_password_key1:
  id = quantom_password_key1
  name = quantom_password_key1
  type = SecureString
  value = HiQ4Kv!h!5!%%4r#E@3576X2x@y!J26N%8$C1xvoG%YX%$Jsdy
quantum_password.test_pw:
  id = -
  created_at = 2017-07-13
  expires_in_days = -1
  length = 50
  name = quantom_password_key1
  password = HiQ4Kv!h!5!%%4r#E@3576X2x@y!J26N%8$C1xvoG%YX%$Jsdy

--- RE-APPLY

aws_ssm_parameter.quantom_password_key1: Modifying... (ID: quantom_password_key1)
  value: "<sensitive>" => "<sensitive>"
aws_ssm_parameter.quantom_password_key1: Modifications complete (ID: quantom_password_key1)
aws_s3_bucket_object.index: Modifying... (ID: quantom_password_key1)
  content: "HiQ4Kv!h!5!%%4r#E@3576X2x@y!J26N%8$C1xvoG%YX%$Jsdy" => "8318!!tGe03%rq2d4Bl34E$Djz$nUE0!%Hx%RB!#F#ff6!#R#O"
aws_s3_bucket_object.index: Modifications complete (ID: quantom_password_key1)

Apply complete! Resources: 0 added, 2 changed, 0 destroyed.

--- SHOW

aws_s3_bucket_object.index:
  id = quantom_password_key1
  acl = private
  bucket = coveo-ndev-test
  cache_control =
  content = 8318!!tGe03%rq2d4Bl34E$Djz$nUE0!%Hx%RB!#F#ff6!#R#O
  content_disposition =
  content_encoding =
  content_language =
  content_type = binary/octet-stream
  etag = 57457f7d03c5c604ac391b6426de9d2f
  key = quantom_password_key1
  server_side_encryption =
  storage_class = STANDARD
  tags.% = 0
  version_id = YpqQeSTLZD8UPo5JtN2Icvpg2S6cO9wV
aws_ssm_parameter.quantom_password_key1:
  id = quantom_password_key1
  name = quantom_password_key1
  type = SecureString
  value = 8318!!tGe03%rq2d4Bl34E$Djz$nUE0!%Hx%RB!#F#ff6!#R#O
quantum_password.test_pw:
  id = -
  created_at = 2017-07-13
  expires_in_days = -1
  length = 50
  name = quantom_password_key1
  password = 8318!!tGe03%rq2d4Bl34E$Djz$nUE0!%Hx%RB!#F#ff6!#R#O

  *** They are now in sync!

  